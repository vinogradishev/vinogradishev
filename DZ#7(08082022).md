#### ДЗ №7 "Журналы"
##### _1.Настроил время выполнения контрольной точки раз в 30 секунд:_ 
> ALTER SYSTEM SET checkpoint_timeout TO 30; 
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/set30sec.png)

##### _2.10 минут нагрузка утилитой pgbench_ 
> Перед запуском посмотрел состояние файлов в pg_wal.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/beforestartpgbench.png)
- хотя и написано, что 2 файла по 16 Мб, по идее они почти пустые, просто зарезервированное место, на начало теста было 10 точек.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/startpgbench.png)

##### _3.Проверяю папку $PGDATA/pg_wal_ 
- Видим четыре новых файла по 16 мб, т.е. за время теста сформировано примерно 64 Мб журналов, в среднем по 3 Мб на контрольную точку.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/afterpgbench.png)

##### _4.Статистика контрольных точек_
- Всего было создано 21 контрольная точка, примерно по 3 мб на контрольную точку, другие были созданы после теста. Точки не всегда проходили по графику, думаю это связано с checkpoint_completion_target, процесс копирования на ЖД растянут и наверное не всегда заказнчивается в срок.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/totalcp.png)

##### _5.Запустил тест pgbench в асинхронном режиме и сравнил с синхронным_
- Разница очевидна, иногда в пять раз быстрее асинхронный режим. Асинхронный - 2200 tps против 450 tps синхронного. Это объясняется тем, что асинхронный режим не ожидает подтверждения для записи на диск, а производит запись через равный промежуток времени, по-этому время отклика значительно возрастает.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/async.png)

##### _6.Создал кластер с включенной контролной суммой страниц, создал таблицу и вставил значения._
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/chksums.png)
- Поменял через vi файл таблицы, сохранил, попробовал сделать выборку и получил ошибку, что таблица была изменена, что контрольная сумма после последней проверки не совпадает:
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/chksumserr.png)
- Чтобы сделать выборку надо включить ignore_checksum_failure, но данные повреждены:
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/6bbe8b45143d7f1f97001aba5ffc7ac2d6a920ab/IGNchksumserr.png)
