### ДЗ №10 "Сбор и использование статистики"
В домашней работе я использовал демо-базу полётов PostgresPRO. При создании таблиц создаются индексы по PK и FK, их я не использовал.

#### _Вариант 1:_ 
##### 1 . Создал индекс по полю 'amount' таблицы ticket_flights, без указания типа индекса, т.е. b-tree индекс.

Без индекса:

>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/amount_wo_ind.png)

С индексом:

>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/amount_w_ind.png)

##### 2 . Вывод команды EXPLAIN:

EXPLAIN SELECT COUNT(*) FROM ticket_flights WHERE amount > 100000;
                                                  
                                                  QUERY PLAN
---------------------------------------------------------------------------------------------------------------
Aggregate  (cost=447.75..447.75 rows=1 width=8)

    ->  Index Only Scan using idx_amount_tick_flights on ticket_flights  (cost=0.42..411.83 rows=14366 width=0)

      Index Cond: (amount > '100000'::numeric)

(3 rows)_

##### 3 . Создал индекс по полю 'city' таблицы airports, для полнотекстового поиска.
- Видно, что индекс используется. 
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/text_idx.png)

##### 4 . Создал индекс по полю 'amount' таблицы ticket_flights, но для билетов стоимостью более 70000.
- Видно, что индекс используется, когда условие совпадает с условием в индексе. 
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/wherecond.png)

##### 5 . Индекс по полям 'flight_id' и 'boarding_no' таблицы boarding_passes.
- Видно, что индекс используется, когда фильтруем по первому полю, по второму индекс не используется. 
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/two_poles.png)

##### 6 . Индексы - очень полезная и нужная вещь.
- b-tree - самый простой индекс, но и эффективный, можно гибко настроить под разные задачи, используя условия.
- индекс для полнотекстового поиска - вещь нужная, но такую базу, где он нужен, надо поискать, это наверное разные форумы, чаты, обмен сообщениями.
- индекс по нескольким полям - так же думаю вещь специфичная, под какую-то конкретную задачу, важен правильный запрос для корректной работы индекса.

##### 7 . Проблема была одна, найти данные для полнотекстового индекса, с остальным не было проблем. Уже потом увидел поля с именами и фамилиями, на него можно реализовать индекс для поиска по тексту, это довольно удобно.

#### _Вариант 2:_ 
##### 1 . Прямое соединение. Соединил таблицы tickets и boarding_passes, получил соответствие номер билета - имя пассажира - номер борта - место.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/779fd7f61a7fb55d80d55a590c32da0427489027/innerjoin.png)

##### 2 . Левое внешнее соединение. Соединил таблицы tickets и boarding_passes, вывел номера билетов и имена пассажиров не прошедших на рейс, LEFT JOIN сохраняет поля из левой таблицы, где нет совпадений.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/779fd7f61a7fb55d80d55a590c32da0427489027/leftjoin.png)

##### 3 . Перекрёстное внешнее соединение. Не очень много смысла в таком соединении, просто соединил aircrafts (9 строк) и seats (1339 строк), получилось 12051 строк.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/779fd7f61a7fb55d80d55a590c32da0427489027/crossjoin.png)

##### 4 . Полное внешнее соединение. Cоединил aircrafts и seats, получил соответствие мест в самолётах и класса комфорта этих мест.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/779fd7f61a7fb55d80d55a590c32da0427489027/fulljoin.png)

##### 5 . Несколько типов сединений. Cоединил tickets, boarding_passes и flights, получил соответствие купленных билетов, мест и номера рейса.
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/779fd7f61a7fb55d80d55a590c32da0427489027/multijoin.png)

##### 6 . JOIN - очень нужный оператор, я очень часто им пользуюсь, при решении задач. CROSS JOIN - сомнительный инструмент, но для всяких рандомных вещей очень полезная вещь.

##### 7 . Структура БД выглядит так:
>> ![alt tag](https://github.com/vinogradishev/vinogradishev/blob/255d61a07c9ad4847e95ff2040ff71e928bd2c7f/structure.png)






